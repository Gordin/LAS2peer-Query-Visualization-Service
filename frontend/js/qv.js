var JSON;if(!JSON){JSON={}}(function(){"use strict";function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else if(typeof space==="string"){indent=space}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}})();if(!window.console){console={log:function(){}}}function Storage(storageName,storageBackend){var that=this;var storage=null;var backend=null;var name=storageName;var isLoading=false;try{if(typeof storageBackend=="undefined"||storageBackend==null){console.log("Warning: did not provided the name of the backend which is to be used. Falling back to auto/persistent!");storageBackend="Persistent"}if(storageBackend=="Persistent"){storageBackend=getBestPersistentBackendName()}switch(storageBackend){case"Cookie":case"HTML5":case"OpenSocial":break;case"SetPref":default:throw"The storage backend is not known/unimplemented: "+storageBackend}backend=storageBackend;try{load(function(retrievedStorage){})}catch(loadError){}}catch(error){throw"Instanciating a JSONStorage failed. Exception: "+error}function getBestPersistentBackendName(){try{if("localStorage"in window&&window["localStorage"]!==null){return"HTML5"}return"Cookie"}catch(error){throw"getBestPersistentBackendName: "+error}}that.load=function(callback){try{var storageObject=null;if(typeof callback=="undefined"||callback==null){callback=function(retrievedStorage){}}switch(backend){case"Cookie":if(document.cookie.length>0){var cookieStart=document.cookie.indexOf(name+"=");var cookieEnd=-1;if(cookieStart!=-1){cookieStart=cookieStart+name.length+1;cookieEnd=document.cookie.indexOf(";",cookieStart);if(cookieEnd==-1){cookieEnd=document.cookie.length}storageObject=document.cookie.substring(cookieStart,cookieEnd);storageObject=storageObject.replace(/#--#/g,"#");storageObject=storageObject.replace(/##/g,";")}}break;case"HTML5":storageObject=localStorage.getItem(name);break;case"OpenSocial":var opensocialRequest=opensocial.newDataRequest();var idspec=opensocial.newIdSpec({userId:"VIEWER",groupId:"SELF"});opensocialRequest.add(opensocialRequest.newFetchPersonAppDataRequest(idspec,name),"get_data");opensocialRequest.send(function(response){if(response.get("get_data").hadError()){callback(null)}else{storageObject=response.get("get_data").getData();if(typeof storageObject=="undefined"||storageObject==null){storageObject={}}else{storageObject=JSON.parse(unescape(storageObject))}storage=storageObject;callback(storage)}});break;case"SetPref":default:callback(null);throw"The storage backend is not known/unimplemented: "+storageBackend}if(typeof storageObject=="undefined"||storageObject==null){storageObject={}}else{storageObject=JSON.parse(unescape(storageObject))}storage=storageObject;callback(storage)}catch(error){throw"Getting the storage object caused an exception: "+error}};that.persist=function(callback){try{if(typeof callback==null){callback=function(response){}}if(typeof storage=="undefined"||storage==null){try{if(!isLoading){isLoading=true;load(function(retrievedStorage){isLoading=false;if(retrievedStorage==null){storage={}}else{storage=retrievedStorage}persist(callback)})}return}catch(error){throw"Exception when trying to load the storage object before persisting it. Error: "+error}}var storageValue=escape(JSON.stringify(storage));switch(backend){case"Cookie":var expireDate=new Date;expireDate.setDate(expireDate.getDate()+9e3);storageValue=storageValue.replace(/#/g,"#--#");storageValue=storageValue.replace(/;/g,"##");document.cookie=name+"="+storageValue+";expires="+expireDate.toUTCString();break;case"HTML5":localStorage.setItem(name,storageValue);break;case"OpenSocial":var opensocialRequest=opensocial.newDataRequest();opensocialRequest.add(opensocialRequest.newUpdatePersonAppDataRequest("VIEWER",name,storageValue),"set_data");opensocialRequest.send(function(response){if(response.get("set_data").hadError()){console.log("Saving OpenSocial Appdata failed: "+JSON.stringify(reponse));callback(false)}else{callback(true)}});break;case"SetPref":default:callback(false);throw"The storage backend is not known/unimplemented: "+storageBackend}callback(true)}catch(error){throw"Setting the storage object caused an exception: "+error}};that.get=function(key){var that=this;try{var value=storage[key];if(typeof value=="undefined"||value==null){value=null}return value}catch(error){throw"Getting the value with the key "+key+" caused an error: "+error}};that.set=function(key,value){var that=this;try{storage[key]=value}catch(error){throw"Setting the value of the key "+key+" caused an error: "+error}};that.clear=function(){var that=this;try{storage={}}catch(error){throw"Clearing/deleting all values in the storage failed/caused an exception. Error: "+error}}}if(!window.console){console={log:function(){}}}function LasAjaxClient(groupName,feedbackHandler,defaultUsername,defaultPassword,defaultServerURL,defaultAppCode){var that=this;var sessionId=null;var user=null;var server=null;var appCode=null;var status="unknown";var timeout=36e5;var feedbackLog=[];var feedback=null;var group="default";var jsonStorage=null;var lastPingTime=-1;var watchdogTimer=null;var isLoggingIn=false;var lastLoginTimestamp=null;var defaults={username:null,password:null,serverURL:null,appCode:null};if(typeof defaultUsername!="undefined"&&defaultUsername!=null){defaults.username=defaultUsername}if(typeof defaultPassword!="undefined"&&defaultPassword!=null){defaults.password=defaultPassword}if(typeof defaultServerURL!="undefined"&&defaultServerURL!=null){defaults.serverURL=defaultServerURL}if(typeof defaultAppCode!="undefined"&&defaultAppCode!=null){defaults.appCode=defaultAppCode}if(defaults.appCode!=null&&defaults.password!=null&&defaults.serverURL!=null&&defaults.username!=null){console.log("Default login credentials are set.")}this.loginStatusWatchdog=function(){try{if(watchdogTimer!=null)clearTimeout(watchdogTimer);var watchdogInterval=12e4;if(status!="loggedIn"&&defaults.appCode!=null&&defaults.password!=null&&defaults.username!=null&&defaults.serverURL!=null){that.login(defaults.username,defaults.password,defaults.serverURL,defaults.appCode);watchdogInterval=2e3}else if(status!="loggedIn"){jsonStorage.load(function(retrievedStorage){var storedSessionId=jsonStorage.get("sessionId");var storedUser=jsonStorage.get("user");var storedServer=jsonStorage.get("server");var storedAppCode=jsonStorage.get("appCode");if(storedSessionId!=null&&storedUser!=null&&storedServer!=null&&storedAppCode!=null){var pingHandler=function(pingStatus){if(pingStatus==204||pingStatus==1223||pingStatus==200){if(status!="loggedIn"&&sessionId!=storedSessionId){status="loggedIn";sessionId=storedSessionId;user=storedUser;server=storedServer;appCode=storedAppCode;feedback(Enums.Feedback.LoginSuccess,"Login (by stored session information) as user "+user+" was successful!")}}else{jsonStorage.clear();jsonStorage.persist(function(response){})}};that.ping(pingHandler,storedServer,storedSessionId)}else{watchdogInterval=5e3}})}else{jsonStorage.load(function(retrievedStorage){var storedSessionId=jsonStorage.get("sessionId");if(typeof storedSessionId=="undefined"||storedSessionId==null){status="loggedOut";feedback(Enums.Feedback.LogoutSuccess,"The Session has been closed by another instance.")}var currentTime=(new Date).getDate();if(currentTime-lastPingTime>9e4){var pingHandler=function(pingStatus){if(pingStatus==204||pingStatus==1223||pingStatus==200){}else{status="error";feedback(Enums.Feedback.LogoutSuccess,"The Session is not valid anymore. Ping status: "+pingStatus);if(watchdogTimer!=null)clearTimeout(watchdogTimer);watchdogTimer=setTimeout(function(){that.loginStatusWatchdog()},1e3)}};that.ping(pingHandler,null,null)}})}watchdogTimer=setTimeout(function(){that.loginStatusWatchdog()},watchdogInterval)}catch(error){feedback(Enums.Feedback.Error,"The login/session watchdog died - the login/session status is no longer monitored! Message: "+error)}};this.login=function(username,password,serverURL,applicationCode){try{if(isLoggingIn){feedback(Enums.Feedback.Warning,"Login is already in progress. Please wait!");return}isLoggingIn=true;if(status=="loggedIn"){feedback(Enums.Feedback.Warning,"Already logged in, aborting login. Please logout first!");return}if(typeof username=="undefined"||username==null){throw"Must provide a username for login!"}if(typeof password=="undefined"||password==null){throw"Must provide a password for login!"}if(typeof serverURL=="undefined"||serverURL==null){throw"Must provide a server url for login!"}if(typeof applicationCode=="undefined"||applicationCode==null){throw"Must provide an  application code for login!"}user=username;server=serverURL;appCode=applicationCode;var onLoadHandler=function(xhr){status="loggedIn";isLoggingIn=false;var xml=xhr.responseXML;try{sessionId=xml.getElementsByTagName("id")[0].firstChild.data}catch(error){}if(typeof sessionId=="undefined"){try{sessionId=xml.documentElement.childNodes[0].text}catch(error){}}if(typeof sessionId=="undefined"||sessionId==null){status="error";feedback(Enums.Feedback.LoginError,"Login failed. Status code: "+xhr.status);return}feedback(Enums.Feedback.LoginSuccess,"Login as user "+user+" was successful!");jsonStorage.load(function(retrievedStorage){});jsonStorage.set("sessionId",sessionId);jsonStorage.set("user",user);jsonStorage.set("server",server);jsonStorage.set("appCode",appCode);jsonStorage.persist(function(response){if(response!=true){feedback(Enums.Feedback.Warning,"Login was successful but sharing the session information with other group instances failed!")}})};var onErrorHandler=function(xhr){isLoggingIn=false;status="loggedOut";feedback(Enums.Feedback.LoginError,"Login failed. Status code: "+xhr.status)};var xhr=getXMLHttpRequest("get",server+"createsession?user="+user+"&passwd="+password+"&timeout="+timeout,onLoadHandler,onErrorHandler,"appcode",appCode);xhr.send()}catch(error){feedback(Enums.Feedback.Error,"Login failed and caused an exception: "+error)}};this.logout=function(){try{if(status!="loggedIn"){jsonStorage.clear();jsonStorage.persist(function(response){});feedback(Enums.Feedback.Warning,"Already logged out, therefore aborting logout().");return}var onLoadHandler=function(xhr){sessionId=null;status="loggedOut";jsonStorage.clear();jsonStorage.persist(function(response){if(response!=true){feedback(Enums.Feedback.Warning,"Clearing/deleting stored session information failed!")}});feedback(Enums.Feedback.LogoutSuccess,"Logged out successfully.")};var onErrorHandler=function(xhr){switch(xhr.status){case 401:case 403:case 412:status="loggedOut";feedback(Enums.Feedback.LogoutSuccess,"Logged out successfully (Session was already closed).");break;default:feedback(Enums.Feedback.LogoutError,"Logout was not successful, cause unknown. Assuming that the session is not valid/connection is broken.");status="error";break}jsonStorage.clear();jsonStorage.persist(function(response){if(response!=true){feedback(Enums.Feedback.Warning,"Clearing/deleting stored session information failed!")}});sessionId=null};var xhr=getXMLHttpRequest("GET",server+"closesession?SESSION="+sessionId,onLoadHandler,onErrorHandler,"appcode",appCode);xhr.send()}catch(error){feedback(Enums.Feedback.Error,"Logout failed and caused an exception: "+error)}};this.invoke=function(serviceName,methodName,parametersAsJSONArray,invokationHandler){try{if(typeof serviceName=="undefined"||serviceName==null||serviceName.length<1){throw"Must provide the name of the service to be invoked!"}if(typeof methodName=="undefined"||methodName==null||methodName.length<1){throw"Must provide the name of the method to be invoked!"}if(typeof parametersAsJSONArray=="undefined"||parametersAsJSONArray==null){throw"Must provide the parameters as JSON Array, if you don't want to pass on parameters provide an empty JSON array!"}if(typeof invokationHandler!="function"){invokationHandler=function(status,result){};feedback("warning","No invokation handler was provided for the invokation of "+serviceName+"."+methodName+". The response will we ignored/dropped but information wether the invokation was successful will always be provided with the feedback handler..")}if(status!="loggedIn"){feedback(Enums.Feedback.InvocationAbort,"Not logged in, therefore aborting the invokation of "+serviceName+"."+methodName);return}var parameterXMLString=buildXMLParameterStringFromJSON(parametersAsJSONArray);var url=server+serviceName+"/"+methodName+"?SESSION="+sessionId;var onLoadHandler=function(xhr){try{if(xhr.status!=200&&xhr.status!=204){var errorExplaination=that.explainLASResponseCode(xhr.status);feedback(Enums.Feedback.InvocationError,"The invocation of "+serviceName+"."+methodName+" failed! Error code: "+xhr.status+" "+errorExplaination);invokationHandler(xhr.status,errorExplaination);return}var result={};var returnType=null;if(xhr.status!=204){if(xhr.responseXML.getElementsByTagName("param")[0].getAttribute("type")=="Array"){returnType=xhr.responseXML.getElementsByTagName("param")[0].getAttribute("class");var values=new Array;for(var i=0;i<xhr.responseXML.getElementsByTagName("element").length;i++){values[i]=xhr.responseXML.getElementsByTagName("element")[i].firstChild.data}result={type:returnType+"[]",value:values}}else{returnType=xhr.responseXML.getElementsByTagName("param")[0].getAttribute("type");result={type:returnType,value:xhr.responseXML.getElementsByTagName("param")[0].textContent}}}else{result={type:"none",value:""}}feedback(Enums.Feedback.InvocationSuccess,"Invocation of "+serviceName+"."+methodName+" was successful.");invokationHandler(xhr.status,result);that.ping(null,null,null)}catch(error){feedback(Enums.Feedback.InvocationError,"Handling the invocation result of "+serviceName+"."+methodName+" failed and caused an exception: "+error)}};var onErrorHandler=function(xhr){var errorExplaination=that.explainLASResponseCode(xhr.status);feedback(Enums.Feedback.InvocationError,"The invocation of "+serviceName+"."+methodName+" failed! Error code: "+xhr.status+" "+errorExplaination);invokationHandler(xhr.status,errorExplaination)};var xhr=getXMLHttpRequest("POST",url,onLoadHandler,onErrorHandler,"Content-type","application/xml");xhr.send(parameterXMLString);feedback(Enums.Feedback.InvocationWorking,methodName+" of the service "+serviceName+" is being invoked...")}catch(error){feedback(Enums.Feedback.Error,"Invokation of "+serviceName+"."+methodName+" failed and caused an exception: "+error)}};this.ping=function(pingHandler,customServer,customSessionId){try{if(typeof customServer=="undefined"||customServer==null){customServer=server}if(typeof customSessionId=="undefined"||customSessionId==null){customSessionId=sessionId}if(typeof pingHandler=="undefined"||pingHandler==null){feedback("warning","Did not provided a callback handler for the session ping! Using a default handler.");pingHandler=function(status){if(customSessionId==sessionId){lastPingTime=(new Date).getDate()}if(status==204||status==1223){feedback(Enums.Feedback.PingSuccess,"Ping/Touch of the session was successfully.")}else{feedback(Enums.Feedback.PingError,"Ping/Touch of the session failed! Error code: "+status+" "+that.explainLASResponseCode(status))}}}var onLoadHandler=onErrorHandler=function(xhr){pingHandler(xhr.status)};var xhr=getXMLHttpRequest("GET",customServer+"touchsession?SESSION="+customSessionId,onLoadHandler,onErrorHandler,"appcode",appCode);xhr.send()}catch(error){feedback(Enums.Feedback.Error,"Exception while pinging/touching the session: "+error)}};this.setCustomSessionData=function(customSessionId,customUsername,customServerURL,customApplicationCode){try{if(typeof customUsername=="undefined"||customUsername==null){throw"Must provide a username when setting custom session data!!"}if(typeof customSessionId=="undefined"||customSessionId==null){throw"Must provide a sessionId when setting custom session data!"}if(typeof customServerURL=="undefined"||customServerURL==null){throw"Must provide a server url when setting custom session data!!"}if(typeof customApplicationCode=="undefined"||customApplicationCode==null){throw"Must provide a applicationCode when setting custom session data!!"}jsonStorage.load(function(retrievedStorage){});jsonStorage.set("sessionId",customSessionId);jsonStorage.set("user",customUsername);jsonStorage.set("server",customServerURL);jsonStorage.set("appCode",customApplicationCode);jsonStorage.persist(function(response){if(response!=true){feedback(Enums.Feedback.Warning,"Setting the custom session data failed! Can set the storage object!")}that.verifyStatus()})}catch(error){feedback(Enums.Feedback.Error,"Exception when trying to set custom session data: "+error)}};this.verifyStatus=function(){that.loginStatusWatchdog()};this.getUsername=function(){return user};this.getSessionId=function(){return sessionId};this.getServer=function(){return server};this.getAppCode=function(){return appCode};this.getStatus=function(){return status};this.getTimeout=function(){return timeout};this.getFeedback=function(){return feedbackLog[feedbackLog.length]};this.getFeedbackLog=function(){return feedbackLog};this.getGroup=function(){return group};function defaultFeedbackHandler(statusCode,message){}function getXMLHttpRequest(type,url,onLoadHandler,onErrorHandler,requestHeaderName,requestHeaderValue){try{if(typeof onLoadHandler=="undefined"||typeof onErrorHandler=="undefined"){feedback(Enums.Feedback.Warning,"No handlers (onLoad/onError) for a XMLHttp request have been set. Setting default ones.");onLoadHandler=function(xhr){feedback(Enums.Feedback.Success,"XMLHttpRequest terminated successfully.")};onErrorHandler=function(xhr){feedback(Enums.Feedback.Error,"XMLHttpRequest resulted in an error. Status/Error code: "+xhr.status)}}if(XMLHttpRequest){var xhr=new XMLHttpRequest;if("withCredentials"in xhr){xhr.addEventListener("load",function(evt){onLoadHandler(xhr)},false);xhr.addEventListener("error",function(evt){onErrorHandler(xhr)},false);xhr.open(type,url,true);if(requestHeaderName!=null&&requestHeaderValue!=null){xhr.setRequestHeader(requestHeaderName,requestHeaderValue)}}else if(window.XDomainRequest){try{xhr=new ActiveXObject("MSXML2.XMLHTTP.3.0");xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status==200||xhr.status==204||xhr.status==1223){onLoadHandler(xhr)}else{onErrorHandler(xhr)}}};xhr.open(type,url);if(requestHeaderName!=null&&requestHeaderValue!=null){xhr.setRequestHeader(requestHeaderName,requestHeaderValue)}}catch(errorMSXML){if(type=="post"||type=="POST"){alert('Failed to use IE MSXML2.XMLHTTP.3.0. \nProbably your IE is not configured to allow "Access data sources across domains" and ActiveX\nFalling back to XDomainRequest but due to a bug in LAS invocations can not be performed!')}feedback(Enums.Feedback.Warning,'Failed to instanciate Msxml2.XMLHTTP (does your IE config allow for ActiveX and "Access data sources across domains"?). Trying XDomainRequest now but invocations will fail because the content-type can not be set! Message: '+errorMSXML);xhr=new XDomainRequest;if(xhr){xhr.status=0;xhr.onload=function(){xhr.status=200;xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";xmlDoc.onreadystatechange=function(){if(xmlDoc.readyState==4){xhr.responseXML=xmlDoc;onLoadHandler(xhr)}};xmlDoc.loadXML(xhr.responseText)};xhr.timeout=function(){onErrorHandler(xhr)};xhr.onerror=function(){onErrorHandler(xhr)};xhr.onprogess=function(){};xhr.timeout="30000";xhr.open(type,url)}else{feedback(Enums.Feedback.Error,"Failed to instanziate a XDomainRequest, the specific cause is unknown.")}}}else{throw"Problem with CORS/XMLHttpRequest: neither withCredentials nor XDomainRequest are supported by your browser! Supported browsers include: Firefox > 3.5 or Chrome > 8 or Safari > ? or IE > 8"}return xhr}else{throw"Problem with CORS/XMLHttpRequest: neither withCredentials nor XDomainRequest are supported by your browser! Supported browsers include: Firefox > 3.5 or Chrome > 8 or Safari > ? or IE > 8"}}catch(error){feedback(Enums.Feedback.Error,"Preparing a XML HTTP request failed due to an exception: "+error);throw"Exception while preparing a XML request. Message: "+error}}function buildXMLParameterStringFromJSON(parametersAsJSONArray){try{if(typeof parametersAsJSONArray=="undefined"||parametersAsJSONArray==null){throw"You need to provide a JSON Array with the paramaters which are to be encoded. If you do not want to encode any paramaters, provide an empty JSON array!"}var paramCount=parametersAsJSONArray.length;var parameterXMLString='<?xml version="1.0" encoding="UTF-8" ?>\n<objectlist count="'+paramCount+'" >\n';for(var i=0;i<paramCount;i++){if(/\[\]$/.test(parametersAsJSONArray[i]["type"])){var arrayType=parametersAsJSONArray[i]["type"].substring(0,parametersAsJSONArray[i]["type"].length-2);if(arrayType=="string"){arrayType="String"}var arrayLength=parametersAsJSONArray[i]["value"].length;parameterXMLString+='	<param type="Array" class="'+arrayType+'" length="'+arrayLength+'">\n';if(arrayType.toLowerCase()=="string"){for(var a=0;a<arrayLength;a++){parameterXMLString+="		<element><![CDATA["+parametersAsJSONArray[i]["value"][a]+"]]></element>\n"}}else{for(a=0;a<arrayLength;a++){parameterXMLString+="		<element>"+parametersAsJSONArray[i]["value"][a]+"</element>\n"}}parameterXMLString+="	</param>\n"}else{if(parametersAsJSONArray[i]["type"].toLowerCase()=="string"){parameterXMLString+='	<param type="String"><![CDATA['+parametersAsJSONArray[i]["value"]+"]]></param>\n"}else{parameterXMLString+='	<param type="'+parametersAsJSONArray[i]["type"]+'">'+parametersAsJSONArray[i]["value"]+"</param>\n"}}}parameterXMLString+="</objectlist>";return parameterXMLString}catch(error){feedback(Enums.Feedback.Error,"Exception when building the request XML file for the invocsation: "+error);throw"Exception when building XML parameter string. Message: "+error}}if(typeof feedbackHandler!="function"||feedbackHandler==null){feedback=defaultFeedbackHandler}else{feedback=feedbackHandler}if(typeof groupName!="undefined"&&groupName!=null){group=groupName}else{group="all"}jsonStorage=new Storage("lasClient_"+group,"Persistent");console.log("Configuredfor group: "+group+","+groupName);that.loginStatusWatchdog()}LasAjaxClient.prototype.explainLASResponseCode=function(code){switch(code){case 0:return"Connection and/or Session problems. No further informations available. If you use Firefox: try another browser or tools like Firebug to get more information - Forefox always returns 0 instead of the detailed status codes. Otherwise check your internet connection, try to logout and login again.";case 401:return"Tried to access a non existent session or to invoke without a valid session. Try to logout and login again.";case 403:return"Tried to access a session from an invalid IP/Host OR access to the service method has been denied.";case 404:return"Service or method does not exist.";case 406:return"Invalid parameter encoding";case 412:return"Session timeout occurred. Try to logout and login again.";case 500:return"Exception thrown during the invokation.";case 501:return"The result of the Invokation cannot be transported.";default:return"The status/response code "+code+" is unknown!"}};function Enums(){}Enums.Feedback={Error:"error",Warning:"warning",Success:"success",InvocationError:"invocationError",InvocationAbort:"invocationAbort",InvocationSuccess:"invocationSuccess",InvocationWorking:"invocationWorking",PingError:"pingError",PingSuccess:"pingSuccess",LoginError:"loginError",LoginSuccess:"loginSuccess",LogoutError:"loginError",LogoutSuccess:"logoutSuccess"};var QV=function(QV){QV.HELPER={};QV.HELPER.clearChildNodes=function(parent){while(parent.childNodes.length>=1){parent.removeChild(parent.firstChild)}};QV.HELPER.hasMethod=function(obj,methodname){return typeof obj[methodname]=="function"};QV.HELPER.getRandomId=function(length,startWithLetter){var text="";var possible="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";if(typeof startWithLetter=="undefined")startWithLetter=false;if(startWithLetter){text+=possible.charAt(Math.floor(Math.random()*52));length--}for(var i=0;i<length;i++)text+=possible.charAt(Math.floor(Math.random()*possible.length));return text};QV.HELPER.stripAndExecuteScript=function(text){var scripts="";var cleaned=text.replace(/<script[^>]*>([\s\S]*?)<\/script>/gi,function(){scripts+=arguments[1];return""});if(window.execScript){window.execScript(scripts)}else{var head=document.getElementsByTagName("head")[0];var scriptElement=document.createElement("script");scriptElement.setAttribute("type","text/javascript");scriptElement.innerHTML=scripts;head.appendChild(scriptElement);head.removeChild(scriptElement)}return cleaned};QV.MODIFICATIONTYPE={IDENTITY:0,LOGARITHMIC:1,NORMALIZATION:2,fromInt:function(i){for(var key in this){if(this.hasOwnProperty(key)){if(typeof this[key]=="number"&&this[key]==i){return key}}}return"NO_SUCH_TYPE"}};QV.VISUALIZATIONTYPE={CSV:0,JSON:1,HTMLTABLE:2,XML:3,GOOGLEPIECHART:4,GOOGLEBARCHART:5,GOOGLELINECHART:6,GOOGLETIMELINECHART:7,GOOGLERADARCHART:8,GOOGLETABLE:9,fromInt:function(i){for(var key in this){if(this.hasOwnProperty(key)){if(typeof this[key]=="number"&&this[key]==i){return key}}}return"NO_SUCH_TYPE"}};QV.DATABASETYPE={DB2:{ID:1,DEFAULTPORT:5e4},MYSQL:{ID:2,DEFAULTPORT:3306},FIREBIRD:{ID:3,DEFAULTPORT:3050},MSSQL:{ID:4,DEFAULTPORT:1433},POSTGRESQL:{ID:5,DEFAULTPORT:5432},DERBY:{ID:6,DEFAULTPORT:1527},ORACLE:{ID:7,DEFAULTPORT:1521},fromInt:function(i){for(var key in this){if(this.hasOwnProperty(key)){if(typeof this[key]=="object"&&typeof this[key].ID=="number"&&this[key].ID==i){return this[key]}}}return"NO_SUCH_TYPE"}};QV.Visualizer=function(){var LASHOST="http://localhost:8080/";var LASSERVICENAME="i5.las2peer.services.queryVisualization.QueryVisualizationService";var LASUSERNAME="anonymous";var LASPASSWORD="anonymous";var lasClient;var loginCallback=function(){};var log=function(msg){console.log(msg)};var retrieve=function(query,databaseKey,modficationTypeIndex,visualizationTypeIndex,outputNode,save,callback){if(lasClient.getStatus()=="loggedIn"){var params=[],paramQuery={},paramQueryParams={},paramDBKey={},paramUseCache={},paramVisualizationType={},paramModificationType={},paramGraphParams={},paramSave={};paramQuery.type="String";paramQuery.value=query;paramQueryParams.type="String[]";paramQueryParams.value=[""];paramDBKey.type="String";paramDBKey.value=databaseKey;paramUseCache.type="boolean";paramUseCache.value=false;paramModificationType.type="int";paramModificationType.value=modficationTypeIndex;paramVisualizationType.type="int";paramVisualizationType.value=visualizationTypeIndex;paramGraphParams.type="String[]";paramGraphParams.value=[""];paramSave.type="boolean";paramSave.value=save;params.push(paramQuery,paramQueryParams,paramDBKey,paramUseCache,paramModificationType,paramVisualizationType,paramGraphParams,paramSave);lasClient.invoke(LASSERVICENAME,"createQuery",params,function(status,result){var output;if(status==200||status==204){if(!save&&outputNode){output=result.value;if(/^The Query has lead to an error./.test(output)){output="<p>The Query has lead to an error. See console for more info.</p>";console.log(result.value)}outputNode.innerHTML=QV.HELPER.stripAndExecuteScript(" "+output)}if(typeof callback=="function"){callback(result.value)}}else{outputNode.innerHTML="Error! Message: "+result}})}};var retrieveFromKey=function(key,outputnode,callback){if(lasClient.getStatus()=="loggedIn"){var params=[],paramKey={};paramKey.type="String";paramKey.value=key;params.push(paramKey);lasClient.invoke(LASSERVICENAME,"visualizeQuery",params,function(status,result){if(status==200||status==204){outputnode.innerHTML=QV.HELPER.stripAndExecuteScript(" "+result.value);if(typeof callback=="function"){callback(result.value)}}else{outputnode.innerHTML="Error! Message: "+result}})}};lasClient=new LasAjaxClient("QueryVisualizer",function(statusCode,message){switch(statusCode){case Enums.Feedback.LoginSuccess:log("Login successful!");loginCallback();break;case Enums.Feedback.LogoutSuccess:log("Logout successful!");break;case Enums.Feedback.LoginError:case Enums.Feedback.LogoutError:log("Login error: "+statusCode+", "+message);break;case Enums.Feedback.InvocationWorking:case Enums.Feedback.InvocationSuccess:case Enums.Feedback.Warning:break;case Enums.Feedback.PingSuccess:break;default:log("Unhandled Error: "+statusCode+", "+message);break}});return{login:function(username,password,callback){if(typeof callback=="function"){loginCallback=callback}if(lasClient.getStatus()=="loggedIn"){loginCallback()}else{lasClient.login(username,password,LASHOST,"queryvisualizer")}},addDatabase:function(databaseKey,databaseTypeCode,username,password,database,host,port,callback){if(lasClient.getStatus()=="loggedIn"){var params=[],paramDBKey={},paramTypeCode={},paramUsername={},paramPassword={},paramDatabase={},paramHost={},paramPort={},paramVisualizationType={};paramDBKey.type="String";paramDBKey.value=databaseKey;paramTypeCode.type="int";
paramTypeCode.value=databaseTypeCode;paramUsername.type="String";paramUsername.value=username;paramPassword.type="String";paramPassword.value=password;paramDatabase.type="String";paramDatabase.value=database;paramHost.type="String";paramHost.value=host;paramPort.type="int";paramPort.value=port;paramVisualizationType.type="int";paramVisualizationType.value=QV.VISUALIZATIONTYPE.JSON;params.push(paramDBKey,paramTypeCode,paramUsername,paramPassword,paramDatabase,paramHost,paramPort,paramVisualizationType);lasClient.invoke(LASSERVICENAME,"addDatabase",params,function(status,result){if(status==200||status==204){try{result.value=JSON.parse(result.value)}catch(e){alert("Error! Failed to parse JSON");return}if(result.value[2]==databaseKey){alert("Database added!");if(typeof callback=="function"){callback(result.value.slice(2))}}else{alert("Database addition failed")}}else{alert("Error! Message: "+result)}})}},removeDatabase:function(databaseKey,callback){if(lasClient.getStatus()=="loggedIn"){var params=[],paramDBKey={},paramVisualizationType={};paramDBKey.type="String";paramDBKey.value=databaseKey;paramVisualizationType.type="int";paramVisualizationType.value=QV.VISUALIZATIONTYPE.JSON;params.push(paramDBKey,paramVisualizationType);lasClient.invoke(LASSERVICENAME,"removeDatabase",params,function(status,result){if(status==200||status==204){try{result.value=JSON.parse(result.value)}catch(e){alert("Error! Failed to parse JSON");return}if(result.value[2]==databaseKey){alert("Database removed!");if(typeof callback=="function"){callback(result.value.slice(2))}}else{alert("Database removal failed")}}else{alert("Error! Message: "+result)}})}},retrieveDatabaseKeys:function(callback){if(lasClient.getStatus()=="loggedIn"){var params=[],paramVisualizationType={};paramVisualizationType.type="int";paramVisualizationType.value=QV.VISUALIZATIONTYPE.JSON;params.push(paramVisualizationType);lasClient.invoke(LASSERVICENAME,"getDatabaseKeys",params,function(status,result){if(status==200||status==204){try{result.value=JSON.parse(result.value)}catch(e){log("Error! Failed to parse JSON");return}if(typeof callback=="function"){callback(result.value.slice(2))}}else{log("Error! Message: "+result)}})}},retrieve:function(query,databaseKey,modficationTypeIndex,visualizationTypeIndex,outputNode,callback){retrieve(query,databaseKey,modficationTypeIndex,visualizationTypeIndex,outputNode,false,callback)},quickRetrieve:function(username,password,query,databaseKey,modficationTypeIndex,visualizationTypeIndex,outputNode){var that=this;this.login(username,password,function(){that.retrieve(query,databaseKey,modficationTypeIndex,visualizationTypeIndex,outputNode,function(){that.logout()})})},retrieveChartKey:function(query,databaseKey,modficationTypeIndex,visualizationTypeIndex,callback){retrieve(query,databaseKey,modficationTypeIndex,visualizationTypeIndex,null,true,callback)},retrieveFromKey:function(key,outputNode,callback){retrieveFromKey(key,outputNode,callback)},quickRetrieveFromKey:function(username,password,key,outputNode){var that=this;this.login(username,password,function(){that.retrieveFromKey(key,outputNode,function(){setTimeout(function(){that.logout()},2e3)})})},fromKey:function(key,outputNode){this.quickRetrieveFromKey(LASUSERNAME,LASPASSWORD,key,outputNode)},logout:function(){lasClient.logout()}}};QV.fromKey=function(key){var randomId=QV.HELPER.getRandomId(10,true);document.write('<div id="'+randomId+'" ></div>');var container=document.getElementById(randomId);var qv=new QV.Visualizer;qv.fromKey(key,container)};return QV}(QV||{});